-- Use Database
USE amit;

-- =========================
-- TABLE CREATION
-- =========================

CREATE TABLE PATIENT (
    PATIENT_ID INT PRIMARY KEY,
    NAME VARCHAR(100),
    AGE INT,
    GENDER VARCHAR(10),
    DISEASE_DIAGNOSED VARCHAR(200)
);

CREATE TABLE DOCTOR (
    DOCTOR_ID INT PRIMARY KEY,
    NAME VARCHAR(100),
    SPECIALIZATION VARCHAR(100),
    CONTACT_NO VARCHAR(15),
    EXPERIENCE_YEARS INT
);

CREATE TABLE AI_SYSTEM (
    AI_ID INT PRIMARY KEY,
    SYSTEM_NAME VARCHAR(100),
    DIAGNOSIS_ACCURACY DECIMAL(5,2),
    VERSION VARCHAR(50),
    DEPLOYMENT_DATE DATE
);

CREATE TABLE APPOINTMENT (
    APPOINTMENT_ID INT PRIMARY KEY,
    PATIENT_ID INT,
    DATE DATE,
    TIME TIME,
    CONSULTATION_TIME VARCHAR(50),
    STATUS VARCHAR(50),
    FOREIGN KEY (PATIENT_ID) REFERENCES PATIENT(PATIENT_ID)
);

CREATE TABLE MEDICAL_RECORDS (
    RECORD_ID INT PRIMARY KEY,
    APPOINTMENT_ID INT,
    DIAGNOSIS_REPORT VARCHAR(255),
    PRESCRIPTION VARCHAR(255),
    TEST_RESULTS VARCHAR(255),
    RECORD_DATES DATE,
    FOREIGN KEY (APPOINTMENT_ID) REFERENCES APPOINTMENT(APPOINTMENT_ID)
);

-- =========================
-- ALTER TABLES (RELATIONS)
-- =========================

ALTER TABLE PATIENT
ADD DOCTOR_ID INT,
ADD FOREIGN KEY (DOCTOR_ID) REFERENCES DOCTOR(DOCTOR_ID);

ALTER TABLE DOCTOR
ADD AI_ID INT,
ADD FOREIGN KEY (AI_ID) REFERENCES AI_SYSTEM(AI_ID);

CREATE TABLE DIAGNOSIS (
    PATIENT_ID INT,
    AI_ID INT,
    PRIMARY KEY (PATIENT_ID, AI_ID),
    FOREIGN KEY (PATIENT_ID) REFERENCES PATIENT(PATIENT_ID),
    FOREIGN KEY (AI_ID) REFERENCES AI_SYSTEM(AI_ID)
);

ALTER TABLE MEDICAL_RECORDS
ADD AI_ID INT,
ADD FOREIGN KEY (AI_ID) REFERENCES AI_SYSTEM(AI_ID);

-- =========================
-- INSERT DATA
-- =========================

INSERT INTO PATIENT
(PATIENT_ID, NAME, AGE, GENDER, DISEASE_DIAGNOSED)
VALUES
(1, 'Amit', 20, 'Male', 'Fever'),
(2, 'Akshat', 20, 'Male', 'Cold'),
(3, 'Anjali', 20, 'Female', 'Flu'),
(4, 'Aditya', 20, 'Male', 'Headache');

INSERT INTO DOCTOR
(DOCTOR_ID, NAME, SPECIALIZATION, CONTACT_NO, EXPERIENCE_YEARS)
VALUES
(101, 'Dr. Sharma', 'Cardiologist', '9876543210', 12),
(102, 'Dr. Mehta', 'Neurologist', '9876543211', 10),
(103, 'Dr. Verma', 'General Physician', '9876543212', 8);

INSERT INTO AI_SYSTEM
(AI_ID, SYSTEM_NAME, DIAGNOSIS_ACCURACY, VERSION, DEPLOYMENT_DATE)
VALUES
(201, 'MediAI Pro', 96.50, 'v2.1', '2025-01-10'),
(202, 'HealthBot X', 94.20, 'v1.8', '2024-11-15');

-- =========================
-- UPDATE RELATIONSHIPS
-- =========================

UPDATE DOCTOR SET AI_ID = 201 WHERE DOCTOR_ID = 101;
UPDATE DOCTOR SET AI_ID = 202 WHERE DOCTOR_ID = 102;
UPDATE DOCTOR SET AI_ID = 201 WHERE DOCTOR_ID = 103;

UPDATE PATIENT SET DOCTOR_ID = 101 WHERE PATIENT_ID = 1;
UPDATE PATIENT SET DOCTOR_ID = 102 WHERE PATIENT_ID = 2;
UPDATE PATIENT SET DOCTOR_ID = 103 WHERE PATIENT_ID = 3;
UPDATE PATIENT SET DOCTOR_ID = 101 WHERE PATIENT_ID = 4;

-- =========================
-- APPOINTMENTS
-- =========================

INSERT INTO APPOINTMENT
(APPOINTMENT_ID, PATIENT_ID, DATE, TIME, CONSULTATION_TIME, STATUS)
VALUES
(301, 1, '2026-02-25', '10:00:00', '15 Minutes', 'Completed'),
(302, 2, '2026-02-25', '11:00:00', '20 Minutes', 'Completed'),
(303, 3, '2026-02-26', '09:30:00', '10 Minutes', 'Pending'),
(304, 4, '2026-02-26', '12:00:00', '15 Minutes', 'Completed');

-- =========================
-- MEDICAL RECORDS
-- =========================

INSERT INTO MEDICAL_RECORDS
(RECORD_ID, APPOINTMENT_ID, DIAGNOSIS_REPORT, PRESCRIPTION, TEST_RESULTS, RECORD_DATES)
VALUES
(401, 301, 'Mild Fever', 'Paracetamol', 'Blood Test Normal', '2026-02-25'),
(402, 302, 'Common Cold', 'Antihistamine', 'No Infection', '2026-02-25'),
(403, 303, 'Seasonal Flu', 'Rest + Fluids', 'Influenza Positive', '2026-02-26'),
(404, 304, 'Migraine', 'Painkillers', 'CT Scan Normal', '2026-02-26');

-- =========================
-- AI DIAGNOSIS MAPPING
-- =========================

INSERT INTO DIAGNOSIS
(PATIENT_ID, AI_ID)
VALUES
(1, 201),
(2, 202),
(3, 201),
(4, 201);

-- =========================
-- FINAL JOIN QUERY
-- =========================

SELECT
    P.NAME AS PATIENT,
    D.NAME AS DOCTOR,
    AI.SYSTEM_NAME,
    A.DATE,
    M.DIAGNOSIS_REPORT
FROM PATIENT P
JOIN DOCTOR D ON P.DOCTOR_ID = D.DOCTOR_ID
JOIN DIAGNOSIS DI ON P.PATIENT_ID = DI.PATIENT_ID
JOIN AI_SYSTEM AI ON DI.AI_ID = AI.AI_ID
JOIN APPOINTMENT A ON P.PATIENT_ID = A.PATIENT_ID
JOIN MEDICAL_RECORDS M ON A.APPOINTMENT_ID = M.APPOINTMENT_ID;